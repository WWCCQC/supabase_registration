# ğŸ“‹ RSM Power Authority Status - à¸à¸²à¸£à¸”à¸¶à¸‡à¹à¸¥à¸°à¹ƒà¸Šà¹‰à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ

## ğŸ¯ à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸—à¸µà¹ˆà¸”à¸¶à¸‡à¸¡à¸²à¸ˆà¸²à¸ Supabase

```typescript
.select("rsm, provider, power_authority, national_id")
         â†‘        â†‘              â†‘            â†‘
         1ï¸âƒ£      2ï¸âƒ£            3ï¸âƒ£           4ï¸âƒ£
```

### **à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸—à¸µà¹ˆà¸”à¸¶à¸‡ (4 à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ):**

| # | à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ | à¸Šà¸™à¸´à¸” | à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡ | à¹ƒà¸Šà¹‰à¹ƒà¸™à¸à¸²à¸£à¸„à¸³à¸™à¸§à¸™ |
|---|---------|------|---------|--------------|
| 1ï¸âƒ£ | **rsm** | String | "RSM2_BMA-East" | âœ… à¸ˆà¸±à¸”à¸à¸¥à¸¸à¹ˆà¸¡ + à¸™à¸±à¸š |
| 2ï¸âƒ£ | **provider** | String | "True", "AIS" | âŒ à¹„à¸¡à¹ˆà¹ƒà¸Šà¹‰ |
| 3ï¸âƒ£ | **power_authority** | String | "Yes", "No" | âœ… à¹à¸¢à¸ Yes/No + à¸™à¸±à¸š |
| 4ï¸âƒ£ | **national_id** | String | "3750100546976" | âœ… Unique counting |

---

## ğŸ“Š à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸à¸²à¸£à¹ƒà¸Šà¹‰à¹à¸•à¹ˆà¸¥à¸°à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ

### 1ï¸âƒ£ **rsm** - à¸Šà¸·à¹ˆà¸­ RSM (Regional Sales Manager)

**à¸”à¸¶à¸‡à¸¡à¸²:**
```typescript
const rsm = String(row.rsm || "").trim();
```

**à¹ƒà¸Šà¹‰à¹ƒà¸™à¹„à¸«à¸™:**

| à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™ | à¸‡à¸²à¸™ | à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸” |
|--------|-----|-----------|
| **Validation** | à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸¡à¸µà¸„à¹ˆà¸² | `if (rsm && rsm !== "null")` â†’ à¸‚à¹‰à¸²à¸¡à¸–à¹‰à¸²à¸§à¹ˆà¸²à¸‡ |
| **Grouping** | à¸ˆà¸±à¸”à¸à¸¥à¸¸à¹ˆà¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ | `groupedData[rsm] = { Yes, No }` |
| **Counting RSM** | à¸™à¸±à¸šà¸ˆà¸³à¸™à¸§à¸™ RSM à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸‹à¹‰à¸³ | `Object.keys(groupedData).length` |
| **Chart Label** | à¹à¸ªà¸”à¸‡à¸Šà¸·à¹ˆà¸­à¹ƒà¸™ Chart | X-axis: RSM names |
| **Summary** | à¸„à¸³à¸™à¸§à¸“ totalRsm | `Object.keys(groupedData).length` |

**à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ:**

```javascript
groupedData = {
  "RSM2_BMA-East": { Yes: Set(50), No: Set(325) },
  "RSM7_UPC-CEW": { Yes: Set(90), No: Set(232) },
  "RSM3_UPC-East": { Yes: Set(73), No: Set(194) },
  // ... à¸£à¸§à¸¡ 8 RSM à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
}

// à¸™à¸±à¸šà¸ˆà¸³à¸™à¸§à¸™ RSM
Object.keys(groupedData).length = 8
```

---

### 2ï¸âƒ£ **provider** - à¸œà¸¹à¹‰à¹ƒà¸«à¹‰à¸šà¸£à¸´à¸à¸²à¸£

**à¸”à¸¶à¸‡à¸¡à¸²:**
```typescript
// à¸”à¸¶à¸‡à¹à¸•à¹ˆà¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹ƒà¸Šà¹‰ (à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸²à¸£à¹€à¸£à¸µà¸¢à¸ API à¹à¸¥à¹‰à¸§à¹„à¸¡à¹ˆà¹ƒà¸Šà¹‰à¸‚à¹‰à¸­à¸¡à¸¹à¸¥)
```

**à¹ƒà¸Šà¹‰à¹ƒà¸™à¹„à¸«à¸™:**

| à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™ | à¹ƒà¸Šà¹‰? | à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸ |
|--------|-----|---------|
| **Validation** | âŒ | à¹„à¸¡à¹ˆà¸¡à¸µà¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š |
| **Grouping** | âŒ | à¹„à¸¡à¹ˆà¸¡à¸µà¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸¥à¸¸à¹ˆà¸¡ |
| **Counting** | âŒ | à¹„à¸¡à¹ˆà¸¡à¸µà¸à¸²à¸£à¸™à¸±à¸š |
| **Chart** | âŒ | à¹„à¸¡à¹ˆà¹à¸ªà¸”à¸‡ |
| **Summary** | âŒ | à¹„à¸¡à¹ˆà¹ƒà¸Šà¹‰ |

**à¸—à¸³à¹„à¸¡à¸”à¸¶à¸‡à¹à¸•à¹ˆà¹„à¸¡à¹ˆà¹ƒà¸Šà¹‰?**
- ğŸ¤” à¸­à¸²à¸ˆà¹€à¸›à¹‡à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸ªà¸£à¸´à¸¡ à¸ªà¸³à¸«à¸£à¸±à¸š future feature
- ğŸ¤” à¸”à¸¶à¸‡à¸¡à¸²à¹€à¸à¸·à¹ˆà¸­ optimization (à¸¥à¸”à¸ˆà¸³à¸™à¸§à¸™ queries)
- ğŸ¤” à¹€à¸«à¸¥à¸·à¸­à¹„à¸§à¹‰à¸ˆà¸²à¸à¸à¸²à¸£ refactor

---

### 3ï¸âƒ£ **power_authority** - à¸­à¸³à¸™à¸²à¸ˆ Yes/No â­ à¸ªà¸³à¸„à¸±à¸

**à¸”à¸¶à¸‡à¸¡à¸²:**
```typescript
const powerAuthority = String(row.power_authority || "").trim();
```

**à¹ƒà¸Šà¹‰à¹ƒà¸™à¹„à¸«à¸™:**

| à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™ | à¸‡à¸²à¸™ | à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸” |
|--------|-----|-----------|
| **Validation** | à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸¡à¸µà¸„à¹ˆà¸² | `if (powerAuthority !== "null")` |
| **Existence Check** | à¸™à¸±à¸šà¸¡à¸µ/à¹„à¸¡à¹ˆà¸¡à¸µ Authority | `nationalIdsWithAuthority.add(nationalId)` |
| **Categorization** | à¹à¸¢à¸ Yes/No | `cleanAuthority === "yes"` â†’ Yes Set |
| | | `cleanAuthority === "no"` â†’ No Set |
| **Grouping** | à¹€à¸à¸´à¹ˆà¸¡à¹€à¸‚à¹‰à¸² Group | `groupedData[rsm].Yes/No.add(nationalId)` |
| **Summary** | à¸™à¸±à¸š totalYes/No | `item.Yes.size` + `item.No.size` |
| **Chart Data** | à¹à¸ªà¸”à¸‡à¸„à¹ˆà¸² | `Yes: counts.Yes.size, No: counts.No.size` |

**à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸à¸²à¸£à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥:**

```javascript
// à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸”à¸´à¸š
power_authority = "Yes"   // à¸«à¸£à¸·à¸­ "NO", "yes", "NO", "n", "Y"

// Step 1: Clean (à¹à¸›à¸¥à¸‡à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¸à¸´à¸¡à¸à¹Œà¹€à¸¥à¹‡à¸)
cleanAuthority = "yes"

// Step 2: Match
if (cleanAuthority === "yes" || cleanAuthority === "y") {
  groupedData["RSM2_BMA-East"].Yes.add("3750100546976")
  nationalIdsWithAuthority.add("3750100546976")
} else if (cleanAuthority === "no" || cleanAuthority === "n") {
  groupedData["RSM2_BMA-East"].No.add("3750100546976")
  nationalIdsWithAuthority.add("3750100546976")
}
```

**à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ:**

```javascript
// à¸ªà¸³à¸«à¸£à¸±à¸š RSM2_BMA-East
groupedData["RSM2_BMA-East"] = {
  Yes: Set { "3750100546976", "1759900398701", ... },  // 50 à¸„à¸™
  No: Set { "3601100964206", "3499900014309", ... }    // 325 à¸„à¸™
}

// Chart data
{
  rsm: "RSM2_BMA-East",
  Yes: 50,
  No: 325,
  total: 375
}

// Summary
totalYes: 389
totalNo: 1720
```

**à¸„à¹ˆà¸²à¸—à¸µà¹ˆà¸¢à¸­à¸¡à¸£à¸±à¸š:**
```javascript
// Yes values
"Yes", "yes", "YES", "y", "Y"

// No values
"No", "no", "NO", "n", "N"

// Other values
à¸–à¸¹à¸ skip (à¹„à¸¡à¹ˆà¸™à¸±à¸šà¹€à¸›à¹‡à¸™ Yes à¸«à¸£à¸·à¸­ No)
```

---

### 4ï¸âƒ£ **national_id** - à¹€à¸¥à¸‚à¸›à¸£à¸°à¸ˆà¸³à¸•à¸±à¸§à¸›à¸£à¸°à¸Šà¸²à¸Šà¸™ â­ à¸ªà¸³à¸„à¸±à¸

**à¸”à¸¶à¸‡à¸¡à¸²:**
```typescript
const nationalId = String(row.national_id || "").trim();
```

**à¹ƒà¸Šà¹‰à¹ƒà¸™à¹„à¸«à¸™:**

| à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™ | à¸‡à¸²à¸™ | à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸” |
|--------|-----|-----------|
| **Validation** | à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸¡à¸µà¸„à¹ˆà¸² | `if (!nationalId) return;` â†’ à¸‚à¹‰à¸²à¸¡à¸–à¹‰à¸²à¸§à¹ˆà¸²à¸‡ |
| **Unique Counting** | à¸™à¸±à¸šà¹„à¸¡à¹ˆà¸‹à¹‰à¸³ | `allNationalIds.add(nationalId)` |
| **RSM Existence** | à¸™à¸±à¸šà¸£à¸­à¸š RSM | `nationalIdsWithRsm.add(nationalId)` |
| **Authority Count** | à¸™à¸±à¸šà¸£à¸­à¸š Authority | `nationalIdsWithAuthority.add(nationalId)` |
| **Grouping** | à¸šà¸±à¸™à¸—à¸¶à¸à¹ƒà¸™ Group | `groupedData[rsm].Yes/No.add(nationalId)` |
| **Size Count** | à¸™à¸±à¸šà¸ˆà¸³à¸™à¸§à¸™à¹ƒà¸™ Set | `.size` (e.g., `counts.Yes.size`) |

**à¸—à¸³à¹„à¸¡à¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰ national_id?**

âœ… **à¹„à¸¡à¹ˆà¸™à¸±à¸šà¸‹à¹‰à¸³ (Unique):**
```javascript
// Without national_id (à¸–à¹‰à¸²à¸™à¸±à¸šà¹à¸„à¹ˆ records)
1,000 records â†’ 1,000
à¹à¸•à¹ˆà¸–à¹‰à¸² 1 à¸„à¸™ à¸¡à¸µà¸«à¸¥à¸²à¸¢ records â†’ à¸™à¸±à¸šà¹€à¸¢à¸­à¸°à¸à¸§à¹ˆà¸² âŒ

// With national_id (à¹ƒà¸Šà¹‰ Set)
1,000 records â†’ 950 unique people
à¸•à¸±à¸§à¸•à¸™à¸•à¸£à¸‡ + à¹„à¸¡à¹ˆà¸™à¸±à¸šà¸‹à¹‰à¸³ âœ…
```

**à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ:**

```javascript
// All national IDs
allNationalIds = Set { 
  "3750100546976",
  "1759900398701",
  "3601100964206",
  ... 
}
allNationalIds.size = 2,905  // à¸Šà¹ˆà¸²à¸‡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” (unique)

// National IDs with RSM
nationalIdsWithRsm = Set {
  "3750100546976",
  "1759900398701",
  ...
}
nationalIdsWithRsm.size = 2,109  // à¸Šà¹ˆà¸²à¸‡à¸—à¸µà¹ˆà¸¡à¸µ RSM

// National IDs with Authority
nationalIdsWithAuthority = Set {
  "3750100546976",
  "1759900398701",
  ...
}
nationalIdsWithAuthority.size = 2,109  // à¸Šà¹ˆà¸²à¸‡à¸—à¸µà¹ˆà¸¡à¸µ Power Authority

// Grouped data
groupedData["RSM2_BMA-East"].Yes = Set {
  "3750100546976",  // â† à¸šà¸±à¸™à¸—à¸¶à¸ ID à¹€à¸à¸·à¹ˆà¸­à¸™à¸±à¸š .size
  "1111111111111",
  ...
}
groupedData["RSM2_BMA-East"].Yes.size = 50
```

---

## ğŸ”„ **Flow à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SELECT: rsm, provider, power_authority, national_id    â”‚
â”‚         â†“        â†“              â†“            â†“          â”‚
â”‚         âœ…      âŒ             âœ…            âœ…         â”‚
â”‚         à¹ƒà¸Šà¹‰     à¹„à¸¡à¹ˆà¹ƒà¸Šà¹‰         à¹ƒà¸Šà¹‰           à¹ƒà¸Šà¹‰        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                     â”‚
        â–¼                                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Validate Row    â”‚            â”‚ Check Values     â”‚
    â”‚                 â”‚            â”‚                  â”‚
    â”‚ â€¢ national_id âœ…â”‚            â”‚ â€¢ national_id âœ…  â”‚
    â”‚   (not empty)   â”‚            â”‚   (not null)     â”‚
    â”‚                 â”‚            â”‚ â€¢ rsm âœ…         â”‚
    â”‚                 â”‚            â”‚   (not null)     â”‚
    â”‚                 â”‚            â”‚ â€¢ power_auth âœ…  â”‚
    â”‚                 â”‚            â”‚   (not null)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ SKIP if invalid             â”‚ proceed
             â”‚                             â”‚
             â–¼                             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Add to Sets (For Unique Counting)              â”‚
        â”‚                                                â”‚
        â”‚ 1. allNationalIds.add(national_id)            â”‚
        â”‚    â†³ à¸•à¸±à¹‰à¸‡à¸™à¸±à¸šà¸ˆà¸³à¸™à¸§à¸™à¸Šà¹ˆà¸²à¸‡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”                  â”‚
        â”‚                                                â”‚
        â”‚ 2. if (rsm has value)                         â”‚
        â”‚    nationalIdsWithRsm.add(national_id)        â”‚
        â”‚    â†³ à¸™à¸±à¸šà¸Šà¹ˆà¸²à¸‡à¸—à¸µà¹ˆà¸¡à¸µ RSM                          â”‚
        â”‚                                                â”‚
        â”‚ 3. if (power_authority has value)             â”‚
        â”‚    nationalIdsWithAuthority.add(national_id)  â”‚
        â”‚    â†³ à¸™à¸±à¸šà¸Šà¹ˆà¸²à¸‡à¸—à¸µà¹ˆà¸¡à¸µ Power Authority             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Create Group if Not Exist   â”‚
        â”‚                             â”‚
        â”‚ if (rsm has value) {        â”‚
        â”‚   if (!groupedData[rsm]) {  â”‚
        â”‚     groupedData[rsm] = {    â”‚
        â”‚       Yes: new Set(),       â”‚
        â”‚       No: new Set()         â”‚
        â”‚     }                       â”‚
        â”‚   }                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Categorize Power Authority into Yes/No         â”‚
        â”‚                                                â”‚
        â”‚ clean = power_authority.toLowerCase()         â”‚
        â”‚                                                â”‚
        â”‚ if (clean === "yes" || clean === "y") {       â”‚
        â”‚   groupedData[rsm].Yes.add(national_id)       â”‚
        â”‚   â†³ à¹€à¸à¸´à¹ˆà¸¡à¹€à¸‚à¹‰à¸² Yes group                        â”‚
        â”‚ } else if (clean === "no" || clean === "n") { â”‚
        â”‚   groupedData[rsm].No.add(national_id)        â”‚
        â”‚   â†³ à¹€à¸à¸´à¹ˆà¸¡à¹€à¸‚à¹‰à¸² No group                         â”‚
        â”‚ }                                              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Result: groupedData Structure                â”‚
        â”‚                                              â”‚
        â”‚ {                                            â”‚
        â”‚   "RSM2_BMA-East": {                        â”‚
        â”‚     Yes: Set(50),    â† 50 unique people    â”‚
        â”‚     No: Set(325)     â† 325 unique people   â”‚
        â”‚   },                                         â”‚
        â”‚   "RSM7_UPC-CEW": {                         â”‚
        â”‚     Yes: Set(90),                          â”‚
        â”‚     No: Set(232)                           â”‚
        â”‚   }                                          â”‚
        â”‚   ...                                        â”‚
        â”‚ }                                            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Transform & Calculate Summary                â”‚
        â”‚                                              â”‚
        â”‚ â€¢ Count Yes.size for each RSM               â”‚
        â”‚ â€¢ Count No.size for each RSM                â”‚
        â”‚ â€¢ Sum all Yes â†’ totalYes = 389             â”‚
        â”‚ â€¢ Sum all No â†’ totalNo = 1,720             â”‚
        â”‚ â€¢ Count RSMs â†’ totalRsm = 8                â”‚
        â”‚ â€¢ Total people â†’ totalTechnicians = 2,905  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ **à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡: 1 Record à¸œà¹ˆà¸²à¸™ Full Process**

```
Input Record from Supabase:
{
  "rsm": "RSM2_BMA-East",
  "provider": "True",
  "power_authority": "Yes",
  "national_id": "3750100546976"
}

Step 1: Extract
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ rsm = "RSM2_BMA-East"                   â”‚
â”‚ provider = "True"        â† à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹ƒà¸Šà¹‰    â”‚
â”‚ powerAuthority = "Yes"                  â”‚
â”‚ nationalId = "3750100546976"            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 2: Validate
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ nationalId ? âœ… "3750100546976" exists  â”‚
â”‚ â†’ Continue                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 3: Add to Global Sets
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ allNationalIds.add("3750100546976")     â”‚
â”‚ â†’ allNationalIds.size += 1              â”‚
â”‚                                         â”‚
â”‚ nationalIdsWithRsm.add("3750100546976") â”‚
â”‚ â†’ nationalIdsWithRsm.size += 1          â”‚
â”‚                                         â”‚
â”‚ nationalIdsWithAuthority.add(...)       â”‚
â”‚ â†’ nationalIdsWithAuthority.size += 1    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 4: Check if RSM Exists
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ rsm = "RSM2_BMA-East" ? âœ… Yes          â”‚
â”‚ â†’ Continue to Step 5                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 5: Create Group if Not Exist
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ groupedData["RSM2_BMA-East"] exists ?   â”‚
â”‚ No â†’ Create                             â”‚
â”‚                                         â”‚
â”‚ groupedData["RSM2_BMA-East"] = {        â”‚
â”‚   Yes: new Set(),                       â”‚
â”‚   No: new Set()                         â”‚
â”‚ }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 6: Clean Power Authority
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ powerAuthority = "Yes"                  â”‚
â”‚ cleanAuthority = "yes"                  â”‚
â”‚ (toLowerCase())                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 7: Match and Add to Group
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ cleanAuthority === "yes" ? âœ… Yes       â”‚
â”‚                                         â”‚
â”‚ groupedData["RSM2_BMA-East"].Yes.add(   â”‚
â”‚   "3750100546976"                       â”‚
â”‚ )                                       â”‚
â”‚ â†’ Yes.size += 1                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Final State:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ groupedData["RSM2_BMA-East"] = {             â”‚
â”‚   Yes: Set { "3750100546976", ... },        â”‚
â”‚   No: Set { ... }                           â”‚
â”‚ }                                           â”‚
â”‚                                             â”‚
â”‚ allNationalIds.size = (previous + 1)       â”‚
â”‚ nationalIdsWithRsm.size = (previous + 1)   â”‚
â”‚ nationalIdsWithAuthority.size = (prev + 1) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ **à¸ªà¸£à¸¸à¸›à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ         â”‚ à¹ƒà¸Šà¹‰? â”‚ à¸‡à¸²à¸™                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ rsm          â”‚ âœ…  â”‚ â€¢ Grouping à¸«à¸¥à¸±à¸                     â”‚
â”‚              â”‚     â”‚ â€¢ Chart X-axis labels              â”‚
â”‚              â”‚     â”‚ â€¢ à¸™à¸±à¸šà¸ˆà¸³à¸™à¸§à¸™ RSM                      â”‚
â”‚              â”‚     â”‚ â€¢ Validation (Skip à¸–à¹‰à¸²à¸§à¹ˆà¸²à¸‡)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ provider     â”‚ âŒ  â”‚ à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹ƒà¸Šà¹‰à¹ƒà¸™à¸à¸²à¸£à¸„à¸³à¸™à¸§à¸™à¹€à¸¥à¸¢             â”‚
â”‚              â”‚     â”‚ (à¸”à¸¶à¸‡à¹à¸•à¹ˆà¹„à¸¡à¹ˆà¹ƒà¸Šà¹‰)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ power_       â”‚ âœ…  â”‚ â€¢ à¹à¸¢à¸ Yes/No categories            â”‚
â”‚ authority    â”‚     â”‚ â€¢ Chart stacked bars               â”‚
â”‚              â”‚     â”‚ â€¢ à¸™à¸±à¸š totalYes/totalNo             â”‚
â”‚              â”‚     â”‚ â€¢ Validation (Skip à¸–à¹‰à¸²à¸§à¹ˆà¸²à¸‡)       â”‚
â”‚              â”‚     â”‚ â€¢ Check record has authority       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ national_id  â”‚ âœ…  â”‚ â€¢ PRIMARY: Unique counting         â”‚
â”‚              â”‚     â”‚ â€¢ à¹€à¸à¹‡à¸šà¹ƒà¸™ Sets (à¹„à¸¡à¹ˆà¸™à¸±à¸šà¸‹à¹‰à¸³)          â”‚
â”‚              â”‚     â”‚ â€¢ Validation (Skip à¸–à¹‰à¸²à¸§à¹ˆà¸²à¸‡)       â”‚
â”‚              â”‚     â”‚ â€¢ à¸™à¸±à¸šà¸—à¸¸à¸à¸•à¸±à¸§à¹à¸›à¸£ (RSM, Auth, etc)   â”‚
â”‚              â”‚     â”‚ â€¢ Key à¸ªà¸³à¸«à¸£à¸±à¸š Set à¹€à¸à¹‡à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š **à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” (2,905 Records)**

### à¸”à¸¶à¸‡à¸¡à¸²à¸ˆà¸²à¸ Supabase:

```javascript
[
  {
    "rsm": "RSM2_BMA-East",
    "provider": "True",
    "power_authority": "Yes",
    "national_id": "3750100546976"
  },
  {
    "rsm": "RSM7_UPC-CEW",
    "provider": "AIS",
    "power_authority": "No",
    "national_id": "1759900398701"
  },
  {
    "rsm": "RSM6_UPC-NOE2",
    "provider": "TOT",
    "power_authority": "Yes",
    "national_id": "3601100964206"
  },
  // ... à¸£à¸§à¸¡ 2,905 records
]
```

### à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¸«à¸¥à¸±à¸‡à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥:

```javascript
// groupedData
{
  "RSM2_BMA-East": {
    Yes: Set { "3750100546976", ... },  // 50 people
    No: Set { "1759900398701", ... }    // 325 people
  },
  "RSM7_UPC-CEW": {
    Yes: Set { "3601100964206", ... },  // 90 people
    No: Set { ... }                      // 232 people
  },
  // ... à¸£à¸§à¸¡ 8 RSMs
}

// chartData (Top 20)
[
  { rsm: "RSM2_BMA-East", Yes: 50, No: 325, total: 375 },
  { rsm: "RSM7_UPC-CEW", Yes: 90, No: 232, total: 322 },
  { rsm: "RSM3_UPC-East", Yes: 73, No: 194, total: 267 },
  // ... 5 more RSMs (only 8 total)
]

// summary
{
  totalRsm: 8,
  totalTechnicians: 2905,           // â† unique national_ids
  totalTechniciansWithRsm: 2109,    // â† national_ids that have rsm
  totalYes: 389,                    // â† sum of all Yes
  totalNo: 1720,                    // â† sum of all No
  recordsWithoutRsm: 796,           // â† don't have rsm
  recordsWithoutAuthority: 796      // â† don't have power_authority
}
```

---

## ğŸ”‘ **Key Points**

### âœ… **à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸­à¸¢à¹ˆà¸²à¸‡à¹à¸™à¹ˆà¸™à¸­à¸™:**
1. **rsm** - à¸ˆà¸±à¸”à¸à¸¥à¸¸à¹ˆà¸¡ + à¸›à¹‰à¸²à¸¢à¸à¸³à¸à¸±à¸š
2. **power_authority** - à¹à¸¢à¸ Yes/No
3. **national_id** - à¸™à¸±à¸š unique values (à¸ªà¸³à¸„à¸±à¸à¸—à¸µà¹ˆà¸ªà¸¸à¸”!)

### âŒ **à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸—à¸µà¹ˆà¸”à¸¶à¸‡à¹à¸•à¹ˆà¹„à¸¡à¹ˆà¹ƒà¸Šà¹‰:**
1. **provider** - à¹„à¸¡à¹ˆà¸¡à¸µà¸à¸²à¸£à¹ƒà¸Šà¹‰à¹ƒà¸™à¸à¸²à¸£à¸„à¸³à¸™à¸§à¸™

### â­ **Most Important Column:**
- **national_id** - à¹ƒà¸Šà¹‰à¸—à¸¸à¸à¸—à¸µà¹ˆà¹€à¸à¸·à¹ˆà¸­ unique counting
  - à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µ â†’ à¸‚à¹‰à¸²à¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸™à¸±à¹‰à¸™
  - à¸–à¹‰à¸²à¸¡à¸µ â†’ à¸šà¸±à¸™à¸—à¸¶à¸à¹ƒà¸™ Sets à¹€à¸à¸·à¹ˆà¸­à¸™à¸±à¸šà¹„à¸¡à¹ˆà¸‹à¹‰à¸³

---

## ğŸš€ **à¸ªà¸£à¸¸à¸›**

| à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ | à¸”à¸¶à¸‡? | à¹ƒà¸Šà¹‰? | à¸‡à¸²à¸™ |
|--------|------|------|-----|
| rsm | âœ… | âœ… | âœ… Grouping, X-axis, Count RSMs |
| provider | âœ… | âŒ | âŒ à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹ƒà¸Šà¹‰ |
| power_authority | âœ… | âœ… | âœ… Yes/No categorization, Chart bars |
| national_id | âœ… | âœ… | âœ… PRIMARY: Unique counting everywhere |

**à¸ªà¹ˆà¸§à¸™à¹ƒà¸«à¸à¹ˆà¹ƒà¸Šà¹‰ national_id à¹€à¸à¸·à¹ˆà¸­à¸™à¸±à¸šà¹„à¸¡à¹ˆà¹ƒà¸«à¹‰à¸‹à¹‰à¸³!** âœ¨
