// CTM Code to Thai Name Mapping
export const CTM_MAPPING: { [key: string]: string } = {
  // Bangkok Metro Areas
  "B015": "‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ_‡∏õ‡∏≤‡∏Å‡πÄ‡∏Å‡∏£‡πá‡∏î",
  "B016": "‡∏ö‡∏≤‡∏á‡∏ö‡∏±‡∏ß‡∏ó‡∏≠‡∏á_‡πÑ‡∏ó‡∏£‡∏ô‡πâ‡∏≠‡∏¢_‡∏ö‡∏≤‡∏á‡∏Å‡∏£‡∏ß‡∏¢_‡∏ö‡∏≤‡∏á‡πÉ‡∏´‡∏ç‡πà",
  "B024": "‡∏ö‡∏≤‡∏á‡πÄ‡∏Ç‡∏ô_‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏µ‡πà_‡∏î‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á_‡∏™‡∏≤‡∏¢‡πÑ‡∏´‡∏°",
  "B025": "‡∏ö‡∏≤‡∏á‡∏ã‡∏∑‡πà‡∏≠_‡∏à‡∏ï‡∏∏‡∏à‡∏±‡∏Å‡∏£_‡∏û‡∏ç‡∏≤‡πÑ‡∏ó_‡∏î‡∏¥‡∏ô‡πÅ‡∏î‡∏á_‡∏´‡πâ‡∏ß‡∏¢‡∏Ç‡∏ß‡∏≤‡∏á",
  "B035": "‡∏•‡∏≥‡∏•‡∏π‡∏Å‡∏Å‡∏≤_‡∏ò‡∏±‡∏ç‡∏ö‡∏∏‡∏£‡∏µ_‡∏´‡∏ô‡∏≠‡∏á‡πÄ‡∏™‡∏∑‡∏≠",
  "B036": "‡∏Ñ‡∏•‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á_‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ_‡∏•‡∏≤‡∏î‡∏´‡∏•‡∏∏‡∏°‡πÅ‡∏Å‡πâ‡∏ß_‡∏™‡∏≤‡∏°‡πÇ‡∏Ñ‡∏Å",
  "B044": "‡∏ö‡∏≤‡∏á‡∏Å‡∏∞‡∏õ‡∏¥_‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏™‡∏π‡∏á_‡∏•‡∏≤‡∏î‡∏û‡∏£‡πâ‡∏≤‡∏ß_‡∏ß‡∏±‡∏á‡∏ó‡∏≠‡∏á‡∏´‡∏•‡∏≤‡∏á",
  "B045": "‡∏õ‡∏£‡∏∞‡πÄ‡∏ß‡∏®_‡∏ö‡∏≤‡∏á‡∏ô‡∏≤_‡∏™‡∏ß‡∏ô‡∏´‡∏•‡∏ß‡∏á",
  "B055": "‡∏°‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ_‡∏Ñ‡∏±‡∏ô‡∏ô‡∏≤‡∏¢‡∏≤‡∏ß_‡∏ö‡∏∂‡∏á‡∏Å‡∏∏‡πà‡∏°",
  "B056": "‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á_‡∏´‡∏ô‡∏≠‡∏á‡∏à‡∏≠‡∏Å_‡∏Ñ‡∏•‡∏≠‡∏á‡∏™‡∏≤‡∏°‡∏ß‡∏≤",
  "B067": "‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£1_‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£2_‡∏û‡∏£‡∏∞‡∏õ‡∏£‡∏∞‡πÅ‡∏î‡∏á_‡∏û‡∏£‡∏∞‡∏™‡∏°‡∏∏‡∏ó‡∏£‡πÄ‡∏à‡∏î‡∏µ‡∏¢‡πå",
  "B068": "‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ_‡∏ö‡∏≤‡∏á‡∏ö‡πà‡∏≠_‡∏ö‡∏≤‡∏á‡πÄ‡∏™‡∏≤‡∏ò‡∏á",
  "B075": "‡∏ö‡∏≤‡∏á‡∏Ç‡∏∏‡∏ô‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô_‡∏à‡∏≠‡∏°‡∏ó‡∏≠‡∏á_‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô_‡∏ò‡∏ô‡∏ö‡∏∏‡∏£‡∏µ_‡∏Ñ‡∏•‡∏≠‡∏á‡∏™‡∏≤‡∏ô_‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ö‡∏π‡∏£‡∏ì‡∏∞_‡∏ó‡∏∏‡πà‡∏á‡∏Ñ‡∏£‡∏∏",
  "B084": "‡∏´‡∏ô‡∏≠‡∏á‡πÅ‡∏Ç‡∏°_‡∏ö‡∏≤‡∏á‡πÅ‡∏Ñ_‡∏ï‡∏•‡∏¥‡πà‡∏á‡∏ä‡∏±‡∏ô_‡∏†‡∏≤‡∏©‡∏µ‡πÄ‡∏à‡∏£‡∏¥‡∏ç_‡∏ó‡∏ß‡∏µ‡∏ß‡∏±‡∏í‡∏ô‡∏≤_‡∏ö‡∏≤‡∏á‡∏Å‡∏≠‡∏Å‡πÉ‡∏´‡∏ç‡πà_‡∏ö‡∏≤‡∏á‡∏Å‡∏≠‡∏Å‡∏ô‡πâ‡∏≠‡∏¢_‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏±‡∏î",
  "B114": "‡∏û‡∏£‡∏∞‡πÇ‡∏Ç‡∏ô‡∏á_‡∏Ñ‡∏•‡∏≠‡∏á‡πÄ‡∏ï‡∏¢_‡∏ß‡∏±‡∏í‡∏ô‡∏≤",
  "B115": "‡∏ö‡∏≤‡∏á‡∏£‡∏±‡∏Å_‡∏™‡∏≤‡∏ó‡∏£_‡∏¢‡∏≤‡∏ô‡∏ô‡∏≤‡∏ß‡∏≤_‡∏ö‡∏≤‡∏á‡∏Ñ‡∏≠‡πÅ‡∏´‡∏•‡∏°_‡∏õ‡πâ‡∏≠‡∏°‡∏õ‡∏£‡∏≤‡∏ö‡∏®‡∏±‡∏ï‡∏£‡∏π‡∏û‡πà‡∏≤‡∏¢_‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡∏ß‡∏á‡∏®‡πå_‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£_‡∏î‡∏∏‡∏™‡∏¥‡∏ï_‡∏õ‡∏ó‡∏∏‡∏°‡∏ß‡∏±‡∏ô_‡∏£‡∏≤‡∏ä‡πÄ‡∏ó‡∏ß‡∏µ"
};

/**
 * ‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏´‡∏±‡∏™ CTM ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
 * @param ctmCode ‡∏£‡∏´‡∏±‡∏™ CTM (‡πÄ‡∏ä‡πà‡∏ô B015-NTB-‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ_‡∏õ‡∏≤‡∏Å‡πÄ‡∏Å‡∏£‡πá‡∏î ‡∏´‡∏£‡∏∑‡∏≠ B015)
 * @returns ‡∏ä‡∏∑‡πà‡∏≠ CTM ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏´‡∏±‡∏™ B-code
 */
// Pattern matching ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° corrupted (encoding issues)
// ‡πÄ‡∏ä‡πà‡∏ô "‡∏•ÔøΩÔøΩÔøΩ‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á" ‡∏´‡∏£‡∏∑‡∏≠ "BKK : ‡∏•ÔøΩÔøΩÔøΩ‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á_‡∏´‡∏ô‡∏≠‡∏á‡∏à‡∏≠‡∏Å_‡∏Ñ‡∏•‡∏≠‡∏á‡∏™‡∏≤‡∏°‡∏ß‡∏≤"
const CORRUPTED_TEXT_PATTERNS: { pattern: RegExp; correctName: string }[] = [
  // B056 - ‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á_‡∏´‡∏ô‡∏≠‡∏á‡∏à‡∏≠‡∏Å_‡∏Ñ‡∏•‡∏≠‡∏á‡∏™‡∏≤‡∏°‡∏ß‡∏≤
  { pattern: /‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á.*‡∏´‡∏ô‡∏≠‡∏á‡∏à‡∏≠‡∏Å|‡∏´‡∏ô‡∏≠‡∏á‡∏à‡∏≠‡∏Å.*‡∏Ñ‡∏•‡∏≠‡∏á‡∏™‡∏≤‡∏°‡∏ß‡∏≤|‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á.*‡∏Ñ‡∏•‡∏≠‡∏á‡∏™‡∏≤‡∏°‡∏ß‡∏≤|‡∏•.*‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á/i, correctName: "‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á_‡∏´‡∏ô‡∏≠‡∏á‡∏à‡∏≠‡∏Å_‡∏Ñ‡∏•‡∏≠‡∏á‡∏™‡∏≤‡∏°‡∏ß‡∏≤" },
  // BKK : ‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£_‡∏î‡∏∏‡∏™‡∏¥‡∏ï_‡∏ö‡∏≤‡∏á‡∏£‡∏±‡∏Å_‡∏™‡∏≤‡∏ó‡∏£_‡∏õ‡πâ‡∏≠‡∏°‡∏õ‡∏£‡∏≤‡∏ö‡∏®‡∏±‡∏ï‡∏£‡∏π‡∏û‡πà‡∏≤‡∏¢... (fix ‡∏™‡∏≤‡∏óÔøΩÔøΩ ‚Üí ‡∏™‡∏≤‡∏ó‡∏£)
  { pattern: /‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£.*‡∏î‡∏∏‡∏™‡∏¥‡∏ï.*‡∏ö‡∏≤‡∏á‡∏£‡∏±‡∏Å.*‡∏™‡∏≤‡∏ó.*‡∏õ‡πâ‡∏≠‡∏°‡∏õ‡∏£‡∏≤‡∏ö/i, correctName: "BKK : ‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£_‡∏î‡∏∏‡∏™‡∏¥‡∏ï_‡∏ö‡∏≤‡∏á‡∏£‡∏±‡∏Å_‡∏™‡∏≤‡∏ó‡∏£_‡∏õ‡πâ‡∏≠‡∏°‡∏õ‡∏£‡∏≤‡∏ö‡∏®‡∏±‡∏ï‡∏£‡∏π‡∏û‡πà‡∏≤‡∏¢_‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡∏ß‡∏á‡∏®‡πå_‡∏¢‡∏≤‡∏ô‡∏ô‡∏≤‡∏ß‡∏≤_‡∏ö‡∏≤‡∏á‡∏Ñ‡∏≠‡πÅ‡∏´‡∏•‡∏°" },
  // B035 - PTT : ‡∏ò‡∏±‡∏ç‡∏ö‡∏∏‡∏£‡∏µ_‡∏´‡∏ô‡∏≠‡∏á‡πÄ‡∏™‡∏∑‡∏≠_‡∏•‡∏≥‡∏•‡∏π‡∏Å‡∏Å‡∏≤ (fix ‡∏•‡∏≥ÔøΩÔøΩ‡∏π‡∏Å‡∏Å‡∏≤ ‚Üí ‡∏•‡∏≥‡∏•‡∏π‡∏Å‡∏Å‡∏≤)
  { pattern: /‡∏ò‡∏±‡∏ç‡∏ö‡∏∏‡∏£‡∏µ.*‡∏´‡∏ô‡∏≠‡∏á‡πÄ‡∏™‡∏∑‡∏≠.*‡∏•‡∏≥.{0,3}‡∏π‡∏Å‡∏Å‡∏≤|‡∏•‡∏≥.{0,3}‡∏π‡∏Å‡∏Å‡∏≤.*‡∏ò‡∏±‡∏ç‡∏ö‡∏∏‡∏£‡∏µ/i, correctName: "PTT : ‡∏ò‡∏±‡∏ç‡∏ö‡∏∏‡∏£‡∏µ_‡∏´‡∏ô‡∏≠‡∏á‡πÄ‡∏™‡∏∑‡∏≠_‡∏•‡∏≥‡∏•‡∏π‡∏Å‡∏Å‡∏≤" },
  // SMP : ‡∏ö‡∏≤‡∏á‡∏ö‡πà‡∏≠_‡∏ö‡∏≤‡∏á‡πÄ‡∏™‡∏≤‡∏ò‡∏á_‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ (fix ÔøΩÔøΩ‡∏≤‡∏á‡∏ö‡πà‡∏≠ ‚Üí ‡∏ö‡∏≤‡∏á‡∏ö‡πà‡∏≠ - U+FFFD replacement chars)
  { pattern: /SMP\s*:.*‡∏≤‡∏á‡∏ö‡πà‡∏≠.*‡∏ö‡∏≤‡∏á‡πÄ‡∏™‡∏≤‡∏ò‡∏á.*‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ/i, correctName: "SMP : ‡∏ö‡∏≤‡∏á‡∏ö‡πà‡∏≠_‡∏ö‡∏≤‡∏á‡πÄ‡∏™‡∏≤‡∏ò‡∏á_‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ" },
  // B055 - BKK : ‡∏°‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ_‡∏Ñ‡∏±‡∏ô‡∏ô‡∏≤‡∏¢‡∏≤‡∏ß_‡∏ö‡∏∂‡∏á‡∏Å‡∏∏‡πà‡∏° (fix ‡∏°‡∏µ‡∏ô‡∏ö‡∏∏ÔøΩÔøΩ‡∏µ ‚Üí ‡∏°‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ)
  { pattern: /‡∏°‡∏µ‡∏ô‡∏ö‡∏∏.{0,8}‡∏µ.*‡∏Ñ‡∏±‡∏ô‡∏ô‡∏≤‡∏¢‡∏≤‡∏ß.*‡∏ö‡∏∂‡∏á‡∏Å‡∏∏‡πà‡∏°|‡∏Ñ‡∏±‡∏ô‡∏ô‡∏≤‡∏¢‡∏≤‡∏ß.*‡∏ö‡∏∂‡∏á‡∏Å‡∏∏‡πà‡∏°/i, correctName: "BKK : ‡∏°‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ_‡∏Ñ‡∏±‡∏ô‡∏ô‡∏≤‡∏¢‡∏≤‡∏ß_‡∏ö‡∏∂‡∏á‡∏Å‡∏∏‡πà‡∏°" },
  // B025 - BKK : ‡∏ö‡∏≤‡∏á‡∏ã‡∏∑‡πà‡∏≠_‡∏à‡∏ï‡∏∏‡∏à‡∏±‡∏Å‡∏£_‡∏û‡∏ç‡∏≤‡πÑ‡∏ó_‡∏î‡∏¥‡∏ô‡πÅ‡∏î‡∏á_‡∏´‡πâ‡∏ß‡∏¢‡∏Ç‡∏ß‡∏≤‡∏á (fix ‡∏û‡∏çÔøΩÔøΩÔøΩ‡πÑ‡∏ó ‚Üí ‡∏û‡∏ç‡∏≤‡πÑ‡∏ó)
  { pattern: /‡∏ö‡∏≤‡∏á‡∏ã‡∏∑‡πà‡∏≠.*‡∏à‡∏ï‡∏∏‡∏à‡∏±‡∏Å‡∏£.*‡∏û‡∏ç.{0,8}‡πÑ‡∏ó.*‡∏î‡∏¥‡∏ô‡πÅ‡∏î‡∏á.*‡∏´‡πâ‡∏ß‡∏¢‡∏Ç‡∏ß‡∏≤‡∏á|‡∏à‡∏ï‡∏∏‡∏à‡∏±‡∏Å‡∏£.*‡∏î‡∏¥‡∏ô‡πÅ‡∏î‡∏á.*‡∏´‡πâ‡∏ß‡∏¢‡∏Ç‡∏ß‡∏≤‡∏á/i, correctName: "BKK : ‡∏ö‡∏≤‡∏á‡∏ã‡∏∑‡πà‡∏≠_‡∏à‡∏ï‡∏∏‡∏à‡∏±‡∏Å‡∏£_‡∏û‡∏ç‡∏≤‡πÑ‡∏ó_‡∏î‡∏¥‡∏ô‡πÅ‡∏î‡∏á_‡∏´‡πâ‡∏ß‡∏¢‡∏Ç‡∏ß‡∏≤‡∏á" },
];

export function mapCtmToThaiName(ctmCode: string): string {
  if (!ctmCode || typeof ctmCode !== 'string') {
    return ctmCode || '';
  }

  const trimmed = ctmCode.trim();

  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö B + 3 ‡∏´‡∏•‡∏±‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  const bCodeMatch = trimmed.match(/^B(\d{3})/);

  if (bCodeMatch) {
    const bCode = `B${bCodeMatch[1]}`;
    const mappedName = CTM_MAPPING[bCode];

    if (mappedName) {
      return mappedName;
    }
  }

  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö pattern ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° corrupted
  for (const { pattern, correctName } of CORRUPTED_TEXT_PATTERNS) {
    if (pattern.test(trimmed)) {
      console.log(`üîß Fixed corrupted text: "${trimmed}" ‚Üí "${correctName}"`);
      return correctName;
    }
  }

  // ‡∏•‡∏ö U+FFFD (Unicode replacement character) ‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà
  if (trimmed.includes('\uFFFD')) {
    const cleaned = trimmed.replace(/\uFFFD/g, '');
    console.log(`‚ö†Ô∏è Removed U+FFFD from CBM: "${trimmed}" ‚Üí "${cleaned}"`);
    return cleaned;
  }

  // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà B-code ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô mapping ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°
  return trimmed;
}

/**
 * ‡πÅ‡∏õ‡∏•‡∏á array ‡∏Ç‡∏≠‡∏á CTM codes ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
 */
export function mapCtmArrayToThaiNames(ctmCodes: string[]): string[] {
  return ctmCodes.map(mapCtmToThaiName);
}

// Export ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö debugging
export function getAllMappings() {
  return CTM_MAPPING;
}

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô B-code ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
export function isBCode(ctmCode: string): boolean {
  if (!ctmCode || typeof ctmCode !== 'string') return false;
  return /^B\d{3}/.test(ctmCode.trim());
}